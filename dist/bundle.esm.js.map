{"version":3,"file":"bundle.esm.js","sources":["../src/index.js"],"sourcesContent":["import _ from 'lodash';\nimport pino from 'pino';\n\nexport default function lift() {\n  this.config.log = this.config.log || {};\n  let pretty;\n\n  if (this.config.log.pretty !== false) {\n    let prettyConfig = _.assign(\n      {\n        errorProps: ['extra', 'seneca'],\n      },\n      this.config.log.pretty\n    );\n    pretty = pino.pretty(prettyConfig);\n    pretty.pipe(process.stdout);\n  }\n\n  let logger = pino(this.config.log, pretty);\n  this.logger = logger;\n\n  logger.log = logger.info.bind(logger);\n\n  // enable als, use traceId\n  if (global.als) {\n    ['log', 'info', 'debug', 'warn', 'error', 'trace'].forEach((key) => {\n      let originFn = logger[key].bind(logger);\n      logger[key] = function wrap(...args) {\n        let traceId = global.als.get('traceId');\n        if (!traceId) {\n          originFn(...args);\n        }\n        else if (args[0] instanceof Error) {\n          originFn(...[...args, global.als.get('traceId')]);\n        }\n        else {\n          originFn(...[global.als.get('traceId'), ...args]);\n        }\n      };\n    });\n  }\n\n  global.logger = logger;\n  return logger;\n}\n"],"names":["lift","config","log","pretty","prettyConfig","_","assign","pino","pipe","process","stdout","logger","info","bind","global","als","forEach","key","originFn","wrap","args","traceId","get","Error"],"mappings":";;;AAGe,SAASA,IAAT,GAAgB;OACxBC,MAAL,CAAYC,GAAZ,GAAkB,KAAKD,MAAL,CAAYC,GAAZ,IAAmB,EAArC;MACIC,MAAJ;;MAEI,KAAKF,MAAL,CAAYC,GAAZ,CAAgBC,MAAhB,KAA2B,KAA/B,EAAsC;QAChCC,eAAeC,EAAEC,MAAF,CACjB;kBACc,CAAC,OAAD,EAAU,QAAV;KAFG,EAIjB,KAAKL,MAAL,CAAYC,GAAZ,CAAgBC,MAJC,CAAnB;;aAMSI,KAAKJ,MAAL,CAAYC,YAAZ,CAAT;WACOI,IAAP,CAAYC,QAAQC,MAApB;;;MAGEC,SAASJ,KAAK,KAAKN,MAAL,CAAYC,GAAjB,EAAsBC,MAAtB,CAAb;OACKQ,MAAL,GAAcA,MAAd;SAEOT,GAAP,GAAaS,OAAOC,IAAP,CAAYC,IAAZ,CAAiBF,MAAjB,CAAb,CAlB6B;;MAqBzBG,OAAOC,GAAX,EAAgB;KACb,KAAD,EAAQ,MAAR,EAAgB,OAAhB,EAAyB,MAAzB,EAAiC,OAAjC,EAA0C,OAA1C,EAAmDC,OAAnD,CAA4DC,GAAD,IAAS;UAC9DC,WAAWP,OAAOM,GAAP,EAAYJ,IAAZ,CAAiBF,MAAjB,CAAf;;aACOM,GAAP,IAAc,SAASE,IAAT,CAAc,GAAGC,IAAjB,EAAuB;YAC/BC,UAAUP,OAAOC,GAAP,CAAWO,GAAX,CAAe,SAAf,CAAd;;YACI,CAACD,OAAL,EAAc;mBACH,GAAGD,IAAZ;SADF,MAGK,IAAIA,KAAK,CAAL,aAAmBG,KAAvB,EAA8B;mBACxB,GAAG,CAAC,GAAGH,IAAJ,EAAUN,OAAOC,GAAP,CAAWO,GAAX,CAAe,SAAf,CAAV,CAAZ;SADG,MAGA;mBACM,GAAG,CAACR,OAAOC,GAAP,CAAWO,GAAX,CAAe,SAAf,CAAD,EAA4B,GAAGF,IAA/B,CAAZ;;OATJ;KAFF;;;SAiBKT,MAAP,GAAgBA,MAAhB;SACOA,MAAP;;;;;"}